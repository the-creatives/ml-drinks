{% extends 'base.html' %}

{% block title %}Drink Detector{% endblock %}

{% block description %}This page is an awesome home page.{% endblock %}


{% block content %}
<!-- Main jumbotron for a primary marketing message or call to action -->

{% load static %}
<head>

</head>
<script src="{% static 'js/app.js' %}" type="text/javascript"></script>

<div class="container">
  <div class="row">
    <h1 class="text-center col-xs-12">Drink Detector</h1>
    <div class="col-xs-8 col-xs-offset-2 col-md-6 col-md-offset-3 paddeddiv">
        <p class="text-center">Drink Detector recognizes alcohol (bottles, cans, solo cups, etc.) in your photos.</p>
    </div>
  </div>

  <div class="row">
      <div class="image_container text-center col-xs-10 col-xs-offset-1 col-md-4 col-md-offset-4">
          {% block image_display %}
          {% if url %}
          <img src="{{ url }}" width="100%" />
          {% endif %}
          {% endblock %}
      </div>
      <div id="result" class="text-center col-xs-10 col-xs-offset-1 col-md-8 col-md-offset-2"></div>
      <div id="batch_result" class="text-center col-xs-10 col-xs-offset-1 col-md-8 col-md-offset-2"></div>
  </div>
  
  <div class="row" style="margin-top: 20px;">
    <form action="/" method="get">
      {% csrf_token %}
      <div class="col-xs-6 col-md-6 col-xs-offset-1 col-md-offset-2">
        <input class="form-control input-lg link-box" name="url" id="inputlg" placeholder="your image url here" type="text">
      </div>
      <div class="col-xs-4 col-md-2">
        <button type="submit" class="btn btn-primary">Submit</button>
      </div>
    </form>
  </div>

  <div class="row">
      <div class="text-center paddeddiv col-xs-12">or</div>
  </div>

  <div class="row">
    <div class="text-center paddeddiv col-xs-12">
      <span style="line-height:2em;">
        <div class="fb-login-button" data-max-rows="1" data-size="large" data-show-faces="false" data-auto-logout-link="false" onlogin="callLoginFunction()">Log In</div>&nbsp;&nbsp;to submit your profile picture
      </span>
    </div>
  </div>

  <div class="row">
    <div class="col-xs-10 col-xs-offset-1 col-md-8 col-md-offset-2 paddeddiv">
      <h2 class="text-center">Details</h2>
      <p class="text-center">Running on top of an indico <a href="https://indico.io/product/custom-collections">Custom Collection</a>, our trained model can be used for large-scale content filtering. We integrated it with Facebook, with the purpose of helping users flag NSFW images that they're tagged in.</p>
    </div>
  </div>
</div>

<script type="text/javascript">
function getResult(alcohol) {
  if (alcohol > .5) {
    return "<p><h3>Alcohol, " + (alcohol*100).toFixed(2) + "% sure</h3>";
  } else {
    return "<p><h3>No alcohol, " + ((1-alcohol)*100).toFixed(2) + "% sure</h3>";
  }
}

{% block results %}
{% if result %}
var alcohol = {{ result.alcohol }};
document.getElementById("result").innerHTML = getResult(alcohol);
{% endif %}
{% endblock %}

{% block batchResults %}
{% if list %}
var fbResults = {{ list }};
var alcoholCount = 0;
var cells = [];

for (var i = 0; i < fbResults.length; i++) {
  var alcohol = fbResults[i][1]["alcohol"];
  if (alcohol > .5) {
    var imageTag = "<img src='" + fbResults[i][0] + "' width='200' />";
    var resultTag = getResult(alcohol);
    cells.push(imageTag + "<br />" + resultTag + "<br />");
    alcoholCount += 1;
  }
}

var tableString = "<table id='fb_photo_grid'>";
for (var i = 0; i < cells.length; i++) {
  if (i % 3 === 0) {
    tableString += "<tr>";
  }
  tableString += "<td>";
  tableString += cells[i];
  tableString += "</td>";
  if (i % 3 === 0 && i > 0) {
    tableString += "</tr>";
  }
}
tableString += "</table>";

document.getElementById("result").innerHTML += tableString;

document.getElementById("result").innerHTML += alcoholCount + " out of " + fbResults.length + " Facebook photos contained alcohol.";
{% endif %}
{% endblock %}
</script>
{% endblock %}
